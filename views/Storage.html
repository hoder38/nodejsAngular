<span id="initial" ng-init="init()"></span>
<nav class="navbar-inverse" id="inverse-navbar">
    <div class="navbar-collapse">
        <div collapse="collapse.storage">
            <ul class="nav navbar-nav side-nav" id="inverse-nav">
                <li class="{{!bookmarkCollpase && 'active' || ''}}">
                    <a href="#" aria-expanded="true" ng-click="bookmarkCollpase = !bookmarkCollpase">
                        Bookmark&nbsp;<i class="glyphicon {{bookmarkCollpase && 'glyphicon-chevron-down' || 'glyphicon-chevron-up'}}"></i>
                    </a>
                    <ul class="nav nav-pills" aria-expanded="true" collapse="bookmarkCollpase">
                        <li ng-click="changeSort('bookmarkSort', 'name')">
                            <a class="nav-pills-trim" href="#">
                                name<i ng-show="bookmarkSort.name" class="{{(bookmarkSort.name === 'desc') && 'fa fa-fw fa-caret-down' || 'fa fa-fw fa-caret-up'}}"></i>
                            </a>
                        </li>
                        <li ng-click="changeSort('bookmarkSort', 'mtime')">
                            <a class="nav-pills-trim" href="#">
                                mtime<i ng-show="bookmarkSort.mtime" class="{{(bookmarkSort.mtime === 'desc') && 'fa fa-fw fa-caret-down' || 'fa fa-fw fa-caret-up'}}"></i>
                            </a>
                        </li>
                        <li class="{{bookmarkEdit && 'active' || ''}}">
                            <a class="nav-pills-trim" ng-click="bookmarkEdit = !bookmarkEdit" href="#">edit</a>
                        </li>
                    </ul>
                    <ul aria-expanded="true" collapse="bookmarkCollpase">
                        <li ng-repeat="item in bookmarkList">
                            <a ng-hide="bookmarkEdit" ng-click="getBookmarkItem(item.id)" href="#">{{item.name}}</a>
                            <a ng-show="bookmarkEdit" confirmed-click="delBookmark(item.id)" ng-confirm-click="Would you sure to delete this bookmark?" href="#">
                                <i class="glyphicon glyphicon-remove"></i>{{item.name}}
                            </a>
                        </li>
                    </ul>
                </li>
                <li ng-repeat="dir in dirList" class="{{!dir.collpase && 'active' || ''}}">
                    <a href="#" aria-expanded="true" ng-click="showTaglist(dir)">
                        {{dir.show}}&nbsp;<i class="glyphicon {{dir.collpase && 'glyphicon-chevron-down' || 'glyphicon-chevron-up'}}"></i>
                    </a>
                    <ul class="nav nav-pills" aria-expanded="true" collapse="dir.collpase">
                        <li ng-click="changeDirSort(dir, 'name')">
                            <a class="nav-pills-trim" href="#">
                                name<i ng-show="dir.sortName" class="{{(dir.sortName === 'desc') && 'fa fa-fw fa-caret-down' || 'fa fa-fw fa-caret-up'}}"></i>
                            </a>
                        </li>
                        <li ng-click="changeDirSort(dir, 'mtime')">
                            <a class="nav-pills-trim" href="#">
                                qtime<i ng-show="dir.sortMtime" class="{{(dir.sortMtime === 'desc') && 'fa fa-fw fa-caret-down' || 'fa fa-fw fa-caret-up'}}"></i>
                            </a>
                        </li>
                        <li ng-show="dirEdit" class="{{dir.edit && 'active' || ''}}">
                            <a class="nav-pills-trim" ng-click="dir.edit = !dir.edit" href="#">edit</a>
                        </li>
                    </ul>
                    <ul aria-expanded="true" collapse="dir.collpase">
                        <li ng-repeat="item in dir.list">
                            <a ng-hide="dir.edit" ng-click="dirItemlist(item.id)" href="#">{{item.name}}</a>
                            <a ng-show="dir.edit" confirmed-click="del2Parent(item.id, dir)" ng-confirm-click="Would you sure to delete this tag?" href="#">
                                <i class="glyphicon glyphicon-remove"></i>{{item.name}}
                            </a>
                        </li>
                        <li ng-show="dir.more">
                            <a>
                                <button class="btn btn-default btn-xs" type="button" ng-click="moreDirtaglist(dir)" ng-disabled="dir.moreDisabled">More</button>
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>
<section id="top-section">
    <form ng-submit="submitText()">
        <div class="input-group">
            <span class="input-group-btn" tooltip="嚴格比對"  tooltip-trigger="mouseenter" tooltip-placement="right">
                <button class="btn {{!exactlyMatch && 'active btn-primary' || 'btn-default'}}" ng-click="exactlyMatch = !exactlyMatch" type="button">
                    <i class="glyphicon {{!exactlyMatch && 'glyphicon-eye-close' || 'glyphicon-eye-open'}}"></i>
                </button>
            </span>
            <input type="text" class="form-control" ng-model="inputText" placeholder="Search Tag" blur-me="searchBlur" />
            <span class="input-group-btn">
                <button class="btn btn-default" type="submit" tooltip="搜尋檔案" tooltip-trigger="mouseenter" tooltip-placement="left">
                    <span class="glyphicon glyphicon-search"></span>
                </button>
            </span>
        </div>
    </form>
    <form ng-submit="addBookmark()" id="new-bookmark" ng-show="bookmarkNew">
        <div class="input-group" >
            <span class="input-group-btn">
                <button class="btn btn-default" ng-click="bookmarkNew = false" type="button">
                    <i class="glyphicon glyphicon-remove"></i>
                </button>
            </span>
            <input type="text" class="form-control" ng-model="bookmarkName" placeholder="New Bookmark" focus-me="bookmarkNewFocus" />
            <span class="input-group-btn">
                <button class="btn btn-default" type="submit">
                    <span class="glyphicon glyphicon-plus"></span>
                </button>
            </span>
        </div>
    </form>
    <form ng-submit="fileEdit()" id="edit-itemName" ng-show="itemNameNew">
        <div class="input-group">
            <span class="input-group-btn">
                <button class="btn btn-info" ng-click="itemNameNew = false" type="button">
                    <i class="glyphicon glyphicon-remove"></i>
                </button>
            </span>
            <input type="text" class="form-control" ng-model="newItemName" placeholder="New Name" focus-me="itemNameNewFocus" />
            <span class="input-group-btn">
                <button class="btn btn-info" type="submit">
                    <span class="glyphicon glyphicon-ok"></span>
                </button>
            </span>
        </div>
    </form>
    <form ng-submit="submitTag()" id="add-tag" ng-show="tagNew">
        <div class="input-group">
            <span class="input-group-btn">
                <button class="btn btn-danger" ng-click="tagNew = false" type="button">
                    <i class="glyphicon glyphicon-remove"></i>
                </button>
            </span>
            <input type="text" class="form-control" ng-model="newTagName" placeholder="New Tag" focus-me="tagNewFocus" />
            <span class="input-group-btn">
                <button class="btn btn-danger" type="submit">
                    <span class="glyphicon glyphicon-ok"></span>
                </button>
            </span>
        </div>
    </form>
    <div class="input-group" ng-show="uploadSub" id="upload-sub">
        <span class="input-group-btn">
            <button class="btn btn-warning" ng-click="uploadSub = false;" type="button">
                <i class="glyphicon glyphicon-remove"></i>
            </button>
        </span>
        <span class="form-control" class="progress">
            {{ miscUploader && miscUploader.progress || 0 }}% Complete
        </span>
        <span class="input-group-btn">
            <div class="btn btn-warning btn-file">
                <span class="glyphicon glyphicon-folder-open"></span>&nbsp;Choose<input type="file" nv-file-select uploader="miscUploader" />
            </div>
        </span>
    </div>
    <ol class="breadcrumb" id="breadcrumb-section">
        <li>
            <input type="checkbox" ng-model="multiSearch" tooltip="多重搜尋" tooltip-trigger="mouseenter" tooltip-placement="bottom" />
        </li>
        <li ng-click="resetStorage()">
            <a tooltip="清空搜尋"  tooltip-trigger="mouseenter" href="#">
                <i class="glyphicon glyphicon-home"></i>
            </a>
        </li>
        <li ng-repeat="item in parentList" ng-click="gotoStorage($parent.this, item, $index)">
            <a href="#">
                <i ng-hide="exactlyList[$index]" class="glyphicon glyphicon-eye-close"></i>
                <i ng-show="exactlyList[$index]" class="glyphicon glyphicon-eye-open"></i>&nbsp;{{item}}
            </a>
        </li>
        <li class="active" ng-repeat="item in historyList" ng-click="gotoStorage($parent.this, item, $index+parentList.length)">
            <a href="#" class="history-point">
                <i ng-hide="exactlyList[$index+parentList.length]" class="glyphicon glyphicon-eye-close"></i>
                <i ng-show="exactlyList[$index+parentList.length]" class="glyphicon glyphicon-eye-open"></i>&nbsp;{{item}}
            </a>
        </li>
        <li ng-show="parentList.length > 0" class="dropdown" dropdown="">
            <span class="dropdown-toggle" dropdown-toggle="" tooltip="儲存到我的最愛" tooltip-trigger="mouseenter" tooltip-placement="bottom">
                <a href="#" class="item-point"><i class="glyphicon glyphicon-floppy-disk"></i>&nbsp;SAVE</a>
            </span>
            <ul class="dropdown-menu" id="bookmark-list">
                <li>
                    <a ng-click="bookmarkNew = true; bookmarkNewFocus = true" href="#">new...</a>
                </li>
                <li class="divider"></li>
                <li ng-repeat="item in bookmarkList">
                    <a ng-click="addBookmark(item.name)" href="#">{{item.name}}</a>
                </li>
            </ul>
        </li>
    </ol>
    <ul class="nav nav-pills" id="item-head" aria-expanded="true">
        <li tooltip="全選 / 取消，點選下方的checkbox可以觀看共同TAG" tooltip-trigger="mouseenter" tooltip-placement="right" class="text-right item-check-head {{!selectList.length && 'active' || ''}}">
            <a ng-click="cancelSelect()" href="#">
                <i class="glyphicon {{selectList.length && 'glyphicon-remove-sign' || 'glyphicon-ok'}}"></i>
            </a>
        <li>
        <li>
            <a href="#" ng-click="changeSort('fileSort', 'name')">
                name
                <i ng-show="fileSort.name" class="{{(fileSort.name === 'desc') && 'fa fa-fw fa-caret-down' || 'fa fa-fw fa-caret-up'}}"></i>
            </a>
        </li>
        <li class="pull-right item-tool {{!selectList.length && 'active' || ''}}" tooltip="{{selectList.length && '新增共同TAG，共同TAG顯示在列表上半部' || '設定，點選下方的expand可以開啟功能列'}}" tooltip-trigger="mouseenter" tooltip-placement="left">
            <a ng-click="openNewTag()" href="#">
                <i class="glyphicon {{selectList.length && 'glyphicon-plus' || 'glyphicon-cog'}}"></i>
            </a>
        <li>
        <li class="pull-right item-count">
            <a href="#" ng-click="changeSort('fileSort', 'count')">
                count
                <i ng-show="fileSort.count" class="{{(fileSort.count === 'desc') && 'fa fa-fw fa-caret-down' || 'fa fa-fw fa-caret-up'}}"></i>
            </a>
        </li>
        <li class="pull-right item-mtime">
            <a href="#" ng-click="changeSort('fileSort', 'mtime')">
                time
                <i ng-show="fileSort.mtime" class="{{(fileSort.mtime === 'desc') && 'fa fa-fw fa-caret-down' || 'fa fa-fw fa-caret-up'}}"></i>
            </a>
        </li>
    </ul>
    <div class="dropdown" dropdown="" is-open="dropdown.item">
        <ul class="dropdown-menu" id="tool-list">
            <li ng-show="toolList.download">
                <a confirmed-click="downloadFile()" ng-confirm-click="Would you sure to download this file?" href="#">download</a>
            </li>
            <li ng-show="toolList.edit">
                <a ng-click="itemNameNew = true; itemNameNewFocus = true;newItemName = toolList.item.name;" href="#">edit</a>
            </li>
            <li ng-show="toolList.upload">
                <a confirmed-click="uploadSub = true" ng-confirm-click="目前支援srt，並且只保留上一個版本的字幕" href="#">upload subtitle</a>
            </li>
            <li ng-show="toolList.recover">
                <a confirmed-click="fileRecover()" ng-confirm-click="Would you sure to recover this file?" href="#">recover</a>
            </li>
            <li ng-show="toolList.del">
                <a confirmed-click="fileDel()" ng-confirm-click="Would you sure to delete this file?" href="#">delete</a>
            </li>
            <li ng-show="toolList.vlogMedia">
                <a confirmed-click="handleMedia('vlog')" ng-confirm-click="Would you sure to vlog this Media?" href="#">vlog media</a>
            </li>
            <li ng-show="toolList.delMedia">
                <a confirmed-click="handleMedia('del')" ng-confirm-click="Would you sure to delete this Media?" href="#">delete media</a>
            </li>
            <li ng-show="toolList.dir" ng-repeat="item in dirList">
                <a confirmed-click="add2Parent(item)" ng-confirm-click="Would you sure to add this tag to Dir?" href="#">{{item.show}}</a>
            </li>
        </ul>
    </div>
</section>
<section id="item-section">
    <div class="table-responsive">
        <table class="table table-hover">
            <tbody>
                <tr ng-repeat="item in itemList" class="{{item.id === latest && 'info' || ''}} {{(item.recycle === 1 || item.recycle === 2 || item.recycle === 3) && 'warning' || ''}} {{item.recycle === 4 && 'danger' || ''}}" ng-if="$index <= dirLocation">
                    <td class="item-check text-center"><input type="checkbox" ng-model="item.select" tooltip="點選觀看共同TAG，顯示在列表上半部" tooltip-trigger="mouseenter" tooltip-placement="right" /></td>
                    <td class="item-name" ng-if="item.media" confirmed-click="handleMedia('act', item)" ng-confirm-click="Would you sure to handle this media?">
                        {{item.name}}<br />type: {{item.media.type}}<br />key: {{item.media.key}}<br />err: {{item.media.err}} {{item.media.split}}
                    </td>
                    <td class="item-name" ng-if="item.status < 2 && !item.media" confirmed-click="downloadFile(item.id)" ng-confirm-click="Would you sure to download this file?">
                        <a href="#" class="item-point"><i class="glyphicon glyphicon-question-sign item-icon"></i>{{item.name}}</a>
                    </td>
                    <td class="item-name" ng-if="item.status === 2 && !item.media" ng-click="showMedia(item, 'image')">
                        <a href="#" class="item-point">
                            <span class="preload-img">
                                <i class="glyphicon glyphicon-picture item-icon"></i>
                                <img ng-src="{{file_url + '/preview/' + item.id | trusted}}" alt="{{item.name}}" class="item-image" />
                            </span>
                            {{item.name}}
                        </a>
                    </td>
                    <td class="item-name" ng-if="item.status === 3 && !item.media" ng-click="showMedia(item, 'video')">
                        <a href="#" class="item-point">
                            <span class="preload-img">
                                <i class="glyphicon glyphicon-facetime-video item-icon"></i>
                                <img ng-src="{{file_url + '/preview/' + item.id | trusted}}" alt="{{item.name}}" class="item-image" />
                            </span>
                            {{item.name}}
                        </a>
                    </td>
                    <td class="item-name" ng-if="item.status === 4 && !item.media" ng-click="showMedia(item, 'music')">
                        <a href="#" class="item-point"><i class="glyphicon glyphicon-headphones item-icon"></i>{{item.name}}</a>
                    </td>
                    <td class="item-name" ng-if="item.status === 5 && !item.media" ng-click="showMedia(item, 'doc')">
                        <a href="#" class="item-point"><i class="glyphicon glyphicon-file item-icon"></i>{{item.name}}</a>
                    </td>
                    <td class="item-name" ng-if="item.status === 6 && !item.media" ng-click="showMedia(item, 'present')">
                        <a href="#" class="item-point"><i class="glyphicon glyphicon-list-alt item-icon"></i>{{item.name}}</a>
                    </td>
                    <td class="item-name" ng-if="item.status === 7 && !item.media" ng-click="showUrl(item)">
                        <a href="#" class="item-point"><i class="glyphicon glyphicon-bookmark item-icon"></i>{{item.name}}</a>
                    </td>
                    <td class="item-mtime">{{item.utime}}</td>
                    <td class="item-count">{{item.count}}</td>
                    <td class="item-tool">
                        <button ng-click="selectItem($event, item)" type="button" class="btn btn-default" aria-expanded="false" tooltip="開啟功能列" tooltip-trigger="mouseenter" tooltip-placement="left">
                            <span class="caret"></span>
                        </button>
                    </td>
                </tr>
                <tr ng-repeat="tag in tagList">
                    <td class="item-check text-center" >
                        <button confirmed-click="delTag(tag)" ng-confirm-click="Would you sure to DELETE this tag? You can only delete tag which you added." type="button" class="btn btn-default" tooltip="刪除此共同TAG，需持有權限" tooltip-trigger="mouseenter" tooltip-placement="right">
                            <i class="glyphicon glyphicon-remove-sign"></i>
                        </button>
                    </td>
                    <td class="item-name" ng-click="exactlyStorage($parent.this, tag)">
                        <a href="#" class="item-point">
                            <i class="glyphicon glyphicon-folder-open item-icon"></i>
                            {{tag}}
                        </a>
                    </td>
                    <td class="item-mtime"></td>
                    <td class="item-count"></td>
                    <td class="item-tool">
                        <button ng-click="selectItem($event, tag)" type="button" class="btn btn-default" aria-expanded="false" tooltip="增加此TAG到預設分類裡" tooltip-trigger="mouseenter" tooltip-placement="left">
                            <span class="caret"></span>
                        </button>
                    </td>
                </tr>
                <tr ng-repeat="tag in exceptList">
                    <td class="item-check text-center">
                        <button confirmed-click="addTag(tag)" ng-confirm-click="Would you sure to ADD this tag?" type="button" class="btn btn-default" tooltip="增加此TAG為共同TAG" tooltip-trigger="mouseenter" tooltip-placement="right">
                            <i class="glyphicon glyphicon-plus-sign"></i>
                        </button>
                    </td>
                    <td class="item-name" ng-click="exactlyStorage($parent.this, tag)">
                        <a href="#" class="history-point">
                            <i class="glyphicon glyphicon-folder-open item-icon"></i>
                            {{tag}}
                        </a>
                    </td>
                    <td class="item-mtime"></td>
                    <td class="item-count"></td>
                    <td class="item-tool">
                        <button ng-click="selectItem($event, tag)" type="button" class="btn btn-default" aria-expanded="false" tooltip="增加此TAG到預設分類裡" tooltip-trigger="mouseenter" tooltip-placement="left">
                            <span class="caret"></span>
                        </button>
                    </td>
                </tr>
                <tr ng-repeat="tag in relativeList">
                    <td class="item-check text-center">
                        <button confirmed-click="addTag(tag)" ng-confirm-click="Would you sure to ADD this tag?" type="button" class="btn btn-default" tooltip="增加此TAG為共同TAG" tooltip-trigger="mouseenter" tooltip-placement="right">
                            <i class="glyphicon glyphicon-plus-sign"></i>
                        </button>
                    </td>
                    <td class="item-name" ng-click="exactlyStorage($parent.this, tag)">
                        <a href="#" class="relative-point">
                            <i class="glyphicon glyphicon-folder-open item-icon"></i>
                            {{tag}}
                        </a>
                    </td>
                    <td class="item-mtime"></td>
                    <td class="item-count"></td>
                    <td class="item-tool">
                        <button ng-click="selectItem($event, tag)" type="button" class="btn btn-default" aria-expanded="false" tooltip="增加此TAG到預設分類裡" tooltip-trigger="mouseenter" tooltip-placement="left">
                            <span class="caret"></span>
                        </button>
                    </td>
                </tr>
                <tr ng-repeat="item in itemList" class="{{item.id === latest && 'info' || ''}} {{(item.recycle === 1 || item.recycle === 2 || item.recycle === 3) && 'warning' || ''}} {{item.recycle === 4 && 'danger' || ''}}" ng-if="$index > dirLocation">
                    <td class="item-check text-center"><input type="checkbox" ng-model="item.select" tooltip="點選觀看共同TAG，顯示在列表上半部" tooltip-trigger="mouseenter" tooltip-placement="right" /></td>
                    <td class="item-name" ng-if="item.media" confirmed-click="handleMedia('act', item)" ng-confirm-click="Would you sure to handle this media?">
                        {{item.name}}<br />type: {{item.media.type}}<br />key: {{item.media.key}}<br />err: {{item.media.err}} {{item.media.split}}
                    </td>
                    <td class="item-name" ng-if="item.status < 2 && !item.media" confirmed-click="downloadFile(item.id)" ng-confirm-click="Would you sure to download this file?">
                        <a href="#" class="item-point"><i class="glyphicon glyphicon-question-sign item-icon"></i>{{item.name}}</a>
                    </td>
                    <td class="item-name" ng-if="item.status === 2 && !item.media" ng-click="showMedia(item, 'image')">
                        <a href="#" class="item-point">
                            <span class="preload-img">
                                <i class="glyphicon glyphicon-picture item-icon"></i>
                                <img ng-src="{{file_url + '/preview/' + item.id | trusted}}" alt="{{item.name}}" class="item-image" />
                            </span>
                            {{item.name}}
                        </a>
                    </td>
                    <td class="item-name" ng-if="item.status === 3 && !item.media" ng-click="showMedia(item, 'video')">
                        <a href="#" class="item-point">
                            <span class="preload-img">
                                <i class="glyphicon glyphicon-facetime-video item-icon"></i>
                                <img ng-src="{{file_url + '/preview/' + item.id | trusted}}" alt="{{item.name}}" class="item-image" />
                            </span>
                            {{item.name}}
                        </a>
                    </td>
                    <td class="item-name" ng-if="item.status === 4 && !item.media" ng-click="showMedia(item, 'music')">
                        <a href="#" class="item-point"><i class="glyphicon glyphicon-headphones item-icon"></i>{{item.name}}</a>
                    </td>
                    <td class="item-name" ng-if="item.status === 5 && !item.media" ng-click="showMedia(item, 'doc')">
                        <a href="#" class="item-point"><i class="glyphicon glyphicon-file item-icon"></i>{{item.name}}</a>
                    </td>
                    <td class="item-name" ng-if="item.status === 6 && !item.media" ng-click="showMedia(item, 'present')">
                        <a href="#" class="item-point"><i class="glyphicon glyphicon-list-alt item-icon"></i>{{item.name}}</a>
                    </td>
                    <td class="item-name" ng-if="item.status === 7 && !item.media" ng-click="showUrl(item)">
                        <a href="#" class="item-point"><i class="glyphicon glyphicon-bookmark item-icon"></i>{{item.name}}</a>
                    </td>
                    <td class="item-mtime">{{item.utime}}</td>
                    <td class="item-count">{{item.count}}</td>
                    <td class="item-tool">
                        <button ng-click="selectItem($event, item)" type="button" class="btn btn-default" aria-expanded="false" tooltip="開啟功能列" tooltip-trigger="mouseenter" tooltip-placement="left">
                            <span class="caret"></span>
                        </button>
                    </td>
                </tr>
                <tr>
                    <td class="item-check text-center"></td>
                    <td class="item-name">
                        <button ng-show="more" class="btn btn-default" type="button" ng-click="moreStorage()" ng-disabled="moreDisabled">More</button>
                    </td>
                    <td class="item-mtime"></td>
                    <td class="item-tool"></td>
                </tr>
            </tbody>
        </table>
    </div>
</section>